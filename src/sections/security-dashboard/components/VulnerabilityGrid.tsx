import { AlertTriangle, GitBranch, Clock, CheckCircle2, XCircle, AlertCircle } from 'lucide-react'
import type { Vulnerability, Repository } from '@/../product/sections/security-dashboard/types'

interface VulnerabilityGridProps {
  vulnerabilities: Vulnerability[]
  repositories: Repository[]
  onViewVulnerability?: (id: string) => void
}

const severityConfig = {
  critical: {
    icon: AlertTriangle,
    bg: 'bg-red-500/10',
    border: 'border-red-500/50',
    text: 'text-red-400',
    label: 'CRITICAL',
    glow: 'from-red-600/20 to-red-600/5',
  },
  high: {
    icon: AlertTriangle,
    bg: 'bg-orange-500/10',
    border: 'border-orange-500/50',
    text: 'text-orange-400',
    label: 'HIGH',
    glow: 'from-orange-600/20 to-orange-600/5',
  },
  medium: {
    icon: AlertCircle,
    bg: 'bg-yellow-500/10',
    border: 'border-yellow-500/50',
    text: 'text-yellow-400',
    label: 'MEDIUM',
    glow: 'from-yellow-600/20 to-yellow-600/5',
  },
  low: {
    icon: AlertCircle,
    bg: 'bg-blue-500/10',
    border: 'border-blue-500/50',
    text: 'text-blue-400',
    label: 'LOW',
    glow: 'from-blue-600/20 to-blue-600/5',
  },
}

const statusConfig = {
  fix_pending: {
    icon: Clock,
    text: 'text-slate-400',
    label: 'Pending',
  },
  pr_created: {
    icon: GitBranch,
    text: 'text-cyan-400',
    label: 'PR Created',
  },
  pr_merged: {
    icon: CheckCircle2,
    text: 'text-emerald-400',
    label: 'Merged',
  },
  ignored: {
    icon: XCircle,
    text: 'text-slate-500',
    label: 'Ignored',
  },
}

export function VulnerabilityGrid({ vulnerabilities, repositories, onViewVulnerability }: VulnerabilityGridProps) {
  if (vulnerabilities.length === 0) {
    return (
      <div className="bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-2xl p-12 text-center">
        <CheckCircle2 className="w-16 h-16 text-emerald-400 mx-auto mb-4" />
        <h3 className="text-xl font-semibold text-white mb-2" style={{ fontFamily: 'Space Grotesk, sans-serif' }}>
          No vulnerabilities found
        </h3>
        <p className="text-slate-400" style={{ fontFamily: 'Inter, sans-serif' }}>
          Your repositories are looking secure. Keep up the good work!
        </p>
      </div>
    )
  }

  return (
    <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
      {vulnerabilities.map(vuln => {
        const severity = severityConfig[vuln.severity]
        const status = statusConfig[vuln.status]
        const SeverityIcon = severity.icon
        const StatusIcon = status.icon
        const repository = repositories.find(r => r.id === vuln.repositoryId)

        return (
          <div
            key={vuln.id}
            onClick={() => onViewVulnerability?.(vuln.id)}
            className="relative group cursor-pointer"
          >
            {/* Glow effect */}
            <div className={`absolute inset-0 bg-gradient-to-br ${severity.glow} rounded-2xl blur-xl opacity-0 group-hover:opacity-100 transition-all duration-300`} />

            {/* Card */}
            <div className={`relative bg-slate-900/90 backdrop-blur-sm border ${severity.border} rounded-2xl p-6 hover:border-opacity-100 transition-all duration-300`}>
              {/* Header */}
              <div className="flex items-start justify-between mb-4">
                {/* Severity Badge */}
                <div className={`flex items-center gap-2 px-3 py-1.5 ${severity.bg} border ${severity.border} rounded-lg`}>
                  <SeverityIcon className={`w-4 h-4 ${severity.text}`} />
                  <span className={`text-xs font-bold ${severity.text} uppercase tracking-wider`} style={{ fontFamily: 'Inter, sans-serif' }}>
                    {severity.label}
                  </span>
                </div>

                {/* Status Icon */}
                <StatusIcon className={`w-5 h-5 ${status.text}`} />
              </div>

              {/* Title */}
              <h3 className="text-lg font-semibold text-white mb-2 line-clamp-2 group-hover:text-violet-300 transition-colors" style={{ fontFamily: 'Space Grotesk, sans-serif' }}>
                {vuln.title}
              </h3>

              {/* Description */}
              <p className="text-sm text-slate-400 mb-4 line-clamp-3" style={{ fontFamily: 'Inter, sans-serif' }}>
                {vuln.description}
              </p>

              {/* Meta Info */}
              <div className="space-y-2">
                {/* Repository */}
                <div className="flex items-center gap-2 text-xs">
                  <div className="w-2 h-2 rounded-full bg-cyan-500" />
                  <span className="text-slate-400" style={{ fontFamily: 'Inter, sans-serif' }}>
                    {repository?.name}
                  </span>
                  <span className="text-slate-600">â€¢</span>
                  <span className="text-slate-500" style={{ fontFamily: 'Inter, sans-serif' }}>
                    {repository?.language}
                  </span>
                </div>

                {/* CVE ID */}
                {vuln.cveId && (
                  <div className="flex items-center gap-2">
                    <span className={`text-xs font-mono ${severity.text} px-2 py-1 ${severity.bg} rounded`} style={{ fontFamily: 'JetBrains Mono, monospace' }}>
                      {vuln.cveId}
                    </span>
                  </div>
                )}

                {/* Status */}
                <div className="flex items-center gap-2 text-xs">
                  <span className="text-slate-500" style={{ fontFamily: 'Inter, sans-serif' }}>Status:</span>
                  <span className={`font-medium ${status.text}`} style={{ fontFamily: 'Inter, sans-serif' }}>
                    {status.label}
                  </span>
                </div>
              </div>

              {/* Affected Files Count */}
              <div className="mt-4 pt-4 border-t border-slate-800">
                <span className="text-xs text-slate-500" style={{ fontFamily: 'Inter, sans-serif' }}>
                  {vuln.affectedFiles.length} file{vuln.affectedFiles.length !== 1 ? 's' : ''} affected
                </span>
              </div>
            </div>
          </div>
        )
      })}
    </div>
  )
}
